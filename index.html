<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acquista MundusCoin</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            color: #333;
            text-align: center;
            padding: 50px;
        }

        h2 {
            color: #2c3e50;
        }

        button {
            background-color: #3498db;
            color: white;
            padding: 15px 32px;
            border: none;
            border-radius: 4px;
            font-size: 18px;
            cursor: pointer;
        }

        button:hover {
            background-color: #2980b9;
        }

        footer {
            margin-top: 20px;
            font-size: 14px;
        }

        a {
            color: #3498db;
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <h2>Acquista MundusCoin</h2>
    <p>Prezzo attuale: 0,01 USD per i primi 6 mesi. Acquista ora!</p>
    <button id="buyButton">Acquista Adesso</button>

    <script src="https://cdn.jsdelivr.net/npm/web3@1.7.5/dist/web3.min.js"></script>
    <script>
        // Verifica daca MetaMask este disponibil
        if (window.ethereum) {
            const web3 = new Web3(window.ethereum);
            ethereum.enable(); // Permette la connessione a MetaMask
        } else {
            alert("Per favore installa MetaMask!");
        }

        // Adresa contractului MundusCoin
        const contractAddress = "0x56DaFC5541884324816369BCF92684775e9E9343";  // Adresa contractului MundusCoin

        // ABI-ul contractului (furnizat anterior)
        const contractABI = [
            {
                "inputs": [],
                "name": "buyTokens",
                "outputs": [],
                "stateMutability": "payable",
                "type": "function"
            }
        ];

        // Creăm o instanță a contractului
        const contract = new web3.eth.Contract(contractABI, contractAddress);

        // Funcție care obține prețul actual al ETH în USD
        async function getETHPrice() {
            const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=ethereum&vs_currencies=usd');
            const data = await response.json();
            return data.ethereum.usd;  // Prețul ETH în USD
        }

        // Funcție care calculează valoarea în ETH pentru 0,01 USD
        async function calculateETHValue() {
            const ethPrice = await getETHPrice();  // Prețul ETH în USD
            const usdAmount = 0.01;  // Prețul dorit în USD
            const ethAmount = usdAmount / ethPrice;  // Conversia la ETH
            return ethAmount;  // Valoarea în ETH
        }

        // Funcție care este apelată la apăsarea butonului
        document.getElementById('buyButton').addEventListener('click', async () => {
            // Obține conturile din MetaMask
            const accounts = await web3.eth.getAccounts();
            const account = accounts[0];  // Folosim primul cont MetaMask conectat

            try {
                const ethValue = await calculateETHValue();  // Calculăm valoarea în ETH
                console.log("Valore in ETH da acquistare: " + ethValue);

                // Trimite tranzacția pentru a cumpăra tokenuri
                await contract.methods.buyTokens().send({ 
                    from: account, 
                    value: web3.utils.toWei(ethValue.toString(), 'ether')  // Conversia la Wei
                });
                alert("Token acquistati con successo!");
            } catch (error) {
                console.error(error);
                alert("Si è verificato un errore con la transazione.");
            }
        });
    </script>

    <footer>
        <p>Per visualizzare il contratto, clicca <a href="https://etherscan.io/address/0x56DaFC5541884324816369BCF92684775e9E9343" target="_blank">qui</a>.</p>
    </footer>
</body>
</html>
